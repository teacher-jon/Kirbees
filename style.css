// --- CONFIGURATION ---
const speechConfig = {
    key: "PASTE_YOUR_AZURE_KEY_HERE", 
    region: "chinaeast2" 
};

// --- VOCABULARY LIST ---
const vocab = {
    adjectives: [
        { word: "Big", kr: "큰", zh: "巨大的", class: "big" },
        { word: "Small", kr: "작은", zh: "小小的", class: "small" },
        { word: "Heavy", kr: "무거운", zh: "沉重的", class: "heavy" },
        { word: "Light", kr: "가벼운", zh: "轻盈的", class: "light" },
        { word: "Red", kr: "빨간", zh: "红色的", class: "red" },
        { word: "Green", kr: "초록", zh: "绿色的", class: "green" },
        { word: "Hard", kr: "단단한", zh: "坚硬的", class: "hard" },
        { word: "Soft", kr: "부드러운", zh: "柔软的", class: "soft" }
    ],
    adverbs: [
        { word: "Quickly", kr: "빨리", zh: "快速地", class: "quickly" },
        { word: "Slowly", kr: "천천히", zh: "慢慢地", class: "slowly" },
        { word: "High", kr: "높게", zh: "高高地", class: "high" },
        { word: "Low", kr: "낮게", zh: "低低地", class: "low" },
        { word: "Quietly", kr: "조용히", zh: "安静地", class: "quietly" },
        { word: "Easily", kr: "쉽게", zh: "容易地", class: "easily" }
    ]
};

let currentLang = 'en';

// --- SETUP ON LOAD ---
window.onload = function() {
    const adjSelect = document.getElementById('adjective-select');
    const advSelect = document.getElementById('adverb-select');

    // Fill the dropdown menus
    vocab.adjectives.forEach(adj => {
        let opt = document.createElement('option');
        opt.value = JSON.stringify(adj);
        opt.innerText = adj.word;
        adjSelect.appendChild(opt);
    });

    vocab.adverbs.forEach(adv => {
        let opt = document.createElement('option');
        opt.value = JSON.stringify(adv);
        opt.innerText = adv.word;
        advSelect.appendChild(opt);
    });
};

function setLanguage(lang) {
    currentLang = lang;
    alert("Language set to: " + lang.toUpperCase());
}

// --- LEVEL CONFIGURATION ---
// The "Correct Answer" for this level
const currentMission = {
    targetWord: "Quickly", // The student MUST pick this
    successMessage: "Great job! Kirby reached the apple!"
};

function activateKirby() {
    // 1. Get chosen words
    const adjData = JSON.parse(document.getElementById('adjective-select').value);
    const advData = JSON.parse(document.getElementById('adverb-select').value);
    const kirby = document.getElementById('kirby');
    const goal = document.getElementById('goal');

    // 2. Reset Position
    kirby.style.transition = 'none'; // Stop moving instantly
    kirby.style.left = '20px';       // Go back to start
    
    // Force browser to accept the reset
    setTimeout(() => {
        kirby.style.transition = 'all 2s ease'; // Turn movement back on

        // 3. CHECK: Did they win?
        if (advData.word === currentMission.targetWord) {
            // --- WINNER LOGIC ---
            // Move Kirby all the way to the Apple (Right side)
            kirby.style.left = '650px'; 
            
            // Speak the Victory Sentence
            speakSentence(adjData, advData);
            
            // Celebrate after he arrives (2 seconds later)
            setTimeout(() => {
                alert(currentMission.successMessage);
                goal.style.display = 'none'; // Kirby "eats" the apple!
            }, 2000);

        } else {
            // --- TRY AGAIN LOGIC ---
            // Kirby only moves a little bit (stuck)
            kirby.style.left = '100px';
            
            // Shake effect (using CSS class)
            kirby.classList.add('shake');
            setTimeout(() => kirby.classList.remove('shake'), 500);

            // Optional: Speak a hint?
            alert("Not quite! The mission says: " + currentMission.targetWord);
        }

        // Apply visual size (Big/Small) regardless of winning
        kirby.classList.add(adjData.class);

    }, 100);
}
// --- SPEECH FUNCTION ---
function speakSentence(adj, adv) {
    // 1. Check if Azure Key is missing
    if (speechConfig.key === "PASTE_YOUR_AZURE_KEY_HERE" || speechConfig.key === "") {
        console.log("No Azure Key found. Using Browser Backup Voice.");
        
        const utterance = new SpeechSynthesisUtterance();
        
        if (currentLang === 'en') {
            utterance.text = `The ${adj.word} Kirby moves ${adv.word}.`;
            utterance.lang = 'en-US';
        } else if (currentLang === 'kr') {
            utterance.text = `${adj.kr} 커비가 ${adv.kr} 움직여요.`;
            utterance.lang = 'ko-KR';
        } else if (currentLang === 'zh') {
            utterance.text = `${adj.zh}卡比${adv.zh}移动。`;
            utterance.lang = 'zh-CN';
        }
        
        window.speechSynthesis.speak(utterance);
        return; // Stop here, don't try to call Azure
    }

    // 2. AZURE SETUP (Only runs if Key exists)
    const speechSDK = window.SpeechSDK;
    const config = speechSDK.SpeechConfig.fromSubscription(speechConfig.key, speechConfig.region);
    
    let textToSpeak = "";
    let voiceName = "";

    if (currentLang === 'en') {
        textToSpeak = `The ${adj.word} Kirby moves ${adv.word}.`;
        voiceName = "en-US-AnaNeural";
    } else if (currentLang === 'kr') {
        textToSpeak = `${adj.kr} 커비가 ${adv.kr} 움직여요.`;
        voiceName = "ko-KR-SunHiNeural";
    } else if (currentLang === 'zh') {
        textToSpeak = `${adj.zh}卡比${adv.zh}移动。`;
        voiceName = "zh-CN-XiaoxiaoNeural";
    }

    config.speechSynthesisVoiceName = voiceName;
    
    const synthesizer = new speechSDK.SpeechSynthesizer(config);

    synthesizer.speakTextAsync(
        textToSpeak,
        result => {
            if (result.reason === speechSDK.ResultReason.SynthesizingAudioCompleted) {
                console.log("Speech working!");
            } else {
                console.error(result.errorDetails);
            }
            synthesizer.close();
        },
        error => {
            console.error(error);
            synthesizer.close();
        }
    );
        /* --- LEVEL 1 GAME STUFF (Apple & Missions) --- */

/* --- THE STAGE (World 1: Green Greens) --- */
#stage {
    width: 100%;
    height: 400px; /* Taller stage */
    /* A nice sky gradient instead of flat blue */
    background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 80%, #90EE90 80%, #228B22 100%);
    position: relative;
    border: 8px solid #4a90e2; /* Cartoon border */
    border-radius: 20px;
    box-shadow: inset 0 0 50px rgba(0,0,0,0.1); /* Inner shadow for depth */
    overflow: hidden;
    margin-bottom: 20px;
}

/* --- THE GOAL (The Bouncing Apple) --- */
#goal {
    font-size: 100px; /* MASSIVE APPLE */
    position: absolute;
    bottom: 50px; /* Sitting on the "grass" line */
    right: 50px; 
    filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3));
    z-index: 5;
    /* Let's make it float up and down! */
    animation: float 2s ease-in-out infinite;
    cursor: pointer;
}

@keyframes float {
    0% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(5deg); }
    100% { transform: translateY(0px) rotate(0deg); }
}

/* --- THE MISSION SIGN --- */
#mission-box {
    background-color: rgba(0, 0, 0, 0.6); /* Semi-transparent black box */
    padding: 10px 20px;
    border-radius: 0 0 15px 15px;
    display: inline-block;
    color: #FFD700; /* Gold text */
    font-size: 28px;
    border: 2px solid white;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}
}

#mission-box {
    position: absolute;
    top: 10px;
    width: 100%;
    text-align: center;
    font-size: 24px;
    color: white; /* White text to stand out on blue sky */
    font-weight: bold;
    text-shadow: 2px 2px 0px black; /* Black outline so it's readable */
    z-index: 10;
}

/* The "Shake" Animation for Wrong Answers */
@keyframes shake-anim {
    0% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    50% { transform: translateX(10px); }
    75% { transform: translateX(-10px); }
    100% { transform: translateX(0); }
}

.shake {
    animation: shake-anim 0.5s;
    border: 4px solid red !important; /* Red warning box */
}
                /* --- THE CONTROLS (Puzzle Piece Look) --- */
.sentence-row {
    background-color: #fff;
    padding: 20px;
    border-radius: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}

/* The Dropdown Menus */
select {
    padding: 15px;
    font-size: 20px;
    border: 3px solid #ff69b4; /* Pink border */
    background-color: white;
    border-radius: 15px;
    color: #333;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 4px 0 #ff1493; /* A "3D" button bottom */
    transition: all 0.1s;
}

select:active {
    transform: translateY(4px); /* Pushes down when clicked */
    box-shadow: none;
}

/* The Big Button */
#activate-btn {
    background: linear-gradient(to bottom, #ff69b4, #ff1493);
    width: 100%;
    max-width: 400px;
    padding: 20px;
    font-size: 28px;
    text-transform: uppercase;
    letter-spacing: 2px;
    border: 4px solid white;
    box-shadow: 0 8px 20px rgba(255, 20, 147, 0.4);
    transform: scale(1);
    transition: transform 0.2s;
}

#activate-btn:hover {
    transform: scale(1.05) rotate(-1deg); /* Wiggles slightly on hover */
}
